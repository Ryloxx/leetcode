#
# @lc app=leetcode id=446 lang=python3
#
# [446] Arithmetic Slices II - Subsequence
#
# https://leetcode.com/problems/arithmetic-slices-ii-subsequence/description/
#
# algorithms
# Hard (39.47%)
# Likes:    1877
# Dislikes: 104
# Total Accepted:    58.2K
# Total Submissions: 133.9K
# Testcase Example:  '[2,4,6,8,10]'
#
# Given an integer array nums, return the number of all the arithmetic
# subsequences of nums.
#
# A sequence of numbers is called arithmetic if it consists of at least three
# elements and if the difference between any two consecutive elements is the
# same.
#
#
# For example, [1, 3, 5, 7, 9], [7, 7, 7, 7], and [3, -1, -5, -9] are
# arithmetic sequences.
# For example, [1, 1, 2, 5, 7] is not an arithmetic sequence.
#
#
# A subsequence of an array is a sequence that can be formed by removing some
# elements (possibly none) of the array.
#
#
# For example, [2,5,10] is a subsequence of [1,2,1,2,4,1,5,10].
#
#
# The test cases are generated so that the answer fits in 32-bit integer.
#
#
# Example 1:
#
#
# Input: nums = [2,4,6,8,10]
# Output: 7
# Explanation: All arithmetic subsequence slices are:
# [2,4,6]
# [4,6,8]
# [6,8,10]
# [2,4,6,8]
# [4,6,8,10]
# [2,4,6,8,10]
# [2,6,10]
#
#
# Example 2:
#
#
# Input: nums = [7,7,7,7,7]
# Output: 16
# Explanation: Any subsequence of this array is arithmetic.
#
#
#
# Constraints:
#
#
# 1Â  <= nums.length <= 1000
# -2^31 <= nums[i] <= 2^31 - 1
#
#
#
from types import MethodType
from typing import List
from collections import defaultdict
from algo_input import run


# @lc code=start
class Solution:

    # O(N^2) time complexity
    # O(N^2) space complexity
    def numberOfArithmeticSlices(self, nums: List[int]) -> int:
        dp = defaultdict(int)
        s = set(nums)
        res = 0
        for i in range(len(nums)):
            for j in range(i):
                r = nums[i] - nums[j]
                if nums[i] + r in s:
                    dp[i, r] += dp[j, r] + 1
                res += dp[j, r]
        return res

    # O(N^3) time complexity
    # O(N^2) space complexity
    # def numberOfArithmeticSlices(self, nums: List[int]) -> int:
    #     dp = [[0] * len(nums) for _ in range(len(nums))]
    #     idxes = defaultdict(list)
    #     for idx, n in enumerate(nums):
    #         idxes[n].append(idx)
    #     res = 0
    #     for i in range(len(nums)):
    #         for j in range(i):
    #             p = 2 * nums[j] - nums[i]
    #             if p not in idxes:
    #                 continue
    #             for x in idxes[p]:
    #                 if x >= j:
    #                     break
    #                 dp[i][j] += dp[j][x] + 1
    #             res += dp[i][j]
    #     return res


# @lc code=end
if __name__ == "__main__":
    run(
        MethodType(Solution.numberOfArithmeticSlices, Solution()),
        [
            ([[1, 1, 2, 3, 4, 5]], 11),
            ([[7, 7, 7, 7, 7, 7]], 42),
            ([[2, 4, 6, 8, 10]], 7),
            ([[2, 2, 4, 6, 8, 10]], 11),
            ([[7, 7, 7]], 1),
            ([[7, 7, 7, 7]], 5),
            ([[7, 7, 7, 7, 7]], 16),
            ([range(1000)], 2781846),
            ([[
                1, 2, 3, 2, 4, 6, 3, 6, 9, 4, 8, 12, 5, 10, 15, 6, 12, 18, 7,
                14, 21, 8, 16, 24, 9, 18, 27, 10, 20, 30, 11, 22, 33, 12, 24,
                36, 13, 26, 39, 14, 28, 42, 15, 30, 45, 16, 32, 48, 17, 34, 51,
                18, 36, 54, 19, 38, 57, 20, 40, 60, 21, 42, 63, 22, 44, 66, 23,
                46, 69, 24, 48, 72, 25, 50, 75, 26, 52, 78, 27, 54, 81, 28, 56,
                84, 29, 58, 87, 30, 60, 90, 31, 62, 93, 32, 64, 96, 33, 66, 99,
                34, 68, 102, 35, 70, 105, 36, 72, 108, 37, 74, 111, 38, 76,
                114, 39, 78, 117, 40, 80, 120, 41, 82, 123, 42, 84, 126, 43,
                86, 129, 44, 88, 132, 45, 90, 135, 46, 92, 138, 47, 94, 141,
                48, 96, 144, 49, 98, 147, 50, 100, 150, 51, 102, 153, 52, 104,
                156, 53, 106, 159, 54, 108, 162, 55, 110, 165, 56, 112, 168,
                57, 114, 171, 58, 116, 174, 59, 118, 177, 60, 120, 180, 61,
                122, 183, 62, 124, 186, 63, 126, 189, 64, 128, 192, 65, 130,
                195, 66, 132, 198, 67, 134, 201, 68, 136, 204, 69, 138, 207,
                70, 140, 210, 71, 142, 213, 72, 144, 216, 73, 146, 219, 74,
                148, 222, 75, 150, 225, 76, 152, 228, 77, 154, 231, 78, 156,
                234, 79, 158, 237, 80, 160, 240, 81, 162, 243, 82, 164, 246,
                83, 166, 249, 84, 168, 252, 85, 170, 255, 86, 172, 258, 87,
                174, 261, 88, 176, 264, 89, 178, 267, 90, 180, 270, 91, 182,
                273, 92, 184, 276, 93, 186, 279, 94, 188, 282, 95, 190, 285,
                96, 192, 288, 97, 194, 291, 98, 196, 294, 99, 198, 297, 100,
                200, 300, 101, 202, 303, 102, 204, 306, 103, 206, 309, 104,
                208, 312, 105, 210, 315, 106, 212, 318, 107, 214, 321, 108,
                216, 324, 109, 218, 327, 110, 220, 330, 111, 222, 333, 112,
                224, 336, 113, 226, 339, 114, 228, 342, 115, 230, 345, 116,
                232, 348, 117, 234, 351, 118, 236, 354, 119, 238, 357, 120,
                240, 360, 121, 242, 363, 122, 244, 366, 123, 246, 369, 124,
                248, 372, 125, 250, 375, 126, 252, 378, 127, 254, 381, 128,
                256, 384, 129, 258, 387, 130, 260, 390, 131, 262, 393, 132,
                264, 396, 133, 266, 399, 134, 268, 402, 135, 270, 405, 136,
                272, 408, 137, 274, 411, 138, 276, 414, 139, 278, 417, 140,
                280, 420, 141, 282, 423, 142, 284, 426, 143, 286, 429, 144,
                288, 432, 145, 290, 435, 146, 292, 438, 147, 294, 441, 148,
                296, 444, 149, 298, 447, 150, 300, 450, 151, 302, 453, 152,
                304, 456, 153, 306, 459, 154, 308, 462, 155, 310, 465, 156,
                312, 468, 157, 314, 471, 158, 316, 474, 159, 318, 477, 160,
                320, 480, 161, 322, 483, 162, 324, 486, 163, 326, 489, 164,
                328, 492, 165, 330, 495, 166, 332, 498, 167, 334, 501, 168,
                336, 504, 169, 338, 507, 170, 340, 510, 171, 342, 513, 172,
                344, 516, 173, 346, 519, 174, 348, 522, 175, 350, 525, 176,
                352, 528, 177, 354, 531, 178, 356, 534, 179, 358, 537, 180,
                360, 540, 181, 362, 543, 182, 364, 546, 183, 366, 549, 184,
                368, 552, 185, 370, 555, 186, 372, 558, 187, 374, 561, 188,
                376, 564, 189, 378, 567, 190, 380, 570, 191, 382, 573, 192,
                384, 576, 193, 386, 579, 194, 388, 582, 195, 390, 585, 196,
                392, 588, 197, 394, 591, 198, 396, 594, 199, 398, 597, 200,
                400, 600, 201, 402, 603, 202, 404, 606, 203, 406, 609, 204,
                408, 612, 205, 410, 615, 206, 412, 618, 207, 414, 621, 208,
                416, 624, 209, 418, 627, 210, 420, 630, 211, 422, 633, 212,
                424, 636, 213, 426, 639, 214, 428, 642, 215, 430, 645, 216,
                432, 648, 217, 434, 651, 218, 436, 654, 219, 438, 657, 220,
                440, 660, 221, 442, 663, 222, 444, 666, 223, 446, 669, 224,
                448, 672, 225, 450, 675, 226, 452, 678, 227, 454, 681, 228,
                456, 684, 229, 458, 687, 230, 460, 690, 231, 462, 693, 232,
                464, 696, 233, 466, 699, 234, 468, 702, 235, 470, 705, 236,
                472, 708, 237, 474, 711, 238, 476, 714, 239, 478, 717, 240,
                480, 720, 241, 482, 723, 242, 484, 726, 243, 486, 729, 244,
                488, 732, 245, 490, 735, 246, 492, 738, 247, 494, 741, 248,
                496, 744, 249, 498, 747, 250, 500, 750, 251, 502, 753, 252,
                504, 756, 253, 506, 759, 254, 508, 762, 255, 510, 765, 256,
                512, 768, 257, 514, 771, 258, 516, 774, 259, 518, 777, 260,
                520, 780, 261, 522, 783, 262, 524, 786, 263, 526, 789, 264,
                528, 792, 265, 530, 795, 266, 532, 798, 267, 534, 801, 268,
                536, 804, 269, 538, 807, 270, 540, 810, 271, 542, 813, 272,
                544, 816, 273, 546, 819, 274, 548, 822, 275, 550, 825, 276,
                552, 828, 277, 554, 831, 278, 556, 834, 279, 558, 837, 280,
                560, 840, 281, 562, 843, 282, 564, 846, 283, 566, 849, 284,
                568, 852, 285, 570, 855, 286, 572, 858, 287, 574, 861, 288,
                576, 864, 289, 578, 867, 290, 580, 870, 291, 582, 873, 292,
                584, 876, 293, 586, 879, 294, 588, 882, 295, 590, 885, 296,
                592, 888, 297, 594, 891, 298, 596, 894, 299, 598, 897, 300,
                600, 900, 301, 602, 903, 302, 604, 906, 303, 606, 909, 304,
                608, 912, 305, 610, 915, 306, 612, 918, 307, 614, 921, 308,
                616, 924, 309, 618, 927, 310, 620, 930, 311, 622, 933, 312,
                624, 936, 313, 626, 939, 314, 628, 942, 315, 630, 945, 316,
                632, 948, 317, 634, 951, 318, 636, 954, 319, 638, 957, 320,
                640, 960, 321, 642, 963, 322, 644, 966, 323, 646, 969, 324,
                648, 972, 325, 650, 975, 326, 652, 978, 327, 654, 981, 328,
                656, 984, 329, 658, 987, 330, 660, 990, 331, 662, 993, 332,
                664, 996, 333, 666, 999, 334
            ]], 4549996),
        ],
    )
